# Windows 11 右键菜单工具

直接显示在 Windows 11 新右键菜单中（无需点击"显示更多选项"）

========================================
使用步骤
========================================

必要条件：
- Windows 10/11 系统
- Visual Studio 2017 或更高版本（需要以下组件）：
  * 使用 C++ 的桌面开发（工作负载）
  * C++ ATL（单个组件 - 必需！）
- 管理员权限

注意：如果你已经安装了 Visual Studio，但构建时提示找不到 atlbase.h，
      需要在 Visual Studio Installer 中添加 ATL 组件：
      1. 打开 Visual Studio Installer
      2. 点击你的 Visual Studio 版本旁边的"修改"
      3. 切换到"单个组件"标签
      4. 搜索"ATL"
      5. 勾选"C++ ATL for latest v143 build tools"
      6. 点击"修改"安装

----------------------------------------
第一步：构建
----------------------------------------

右键点击 build.bat，选择"以管理员身份运行"

build.bat 会自动完成：
1. 清理旧的构建文件
2. 创建自签名证书（如果不存在）
3. 编译 C++ COM DLL
4. 编译简单的占位程序
5. 打包并签名
6. 将结果放到 dist 目录

首次运行时会创建证书，之后再次运行会跳过证书创建步骤。

----------------------------------------
第二步：安装
----------------------------------------

进入 dist 目录
右键点击 install.bat，选择"以管理员身份运行"

（如果 .bat 文件不工作，可以右键点击 install.ps1，选择"使用 PowerShell 运行"）

会自动完成：
1. 安装证书
2. 安装右键菜单包

----------------------------------------
第三步：测试
----------------------------------------

1. 右键点击任意文件或文件夹
2. 应该能直接看到"My Right-Click Menu"菜单项
3. 点击后会显示选中的文件路径

注意：可能需要重启 Windows 资源管理器或重启电脑才能生效

----------------------------------------
卸载
----------------------------------------

进入 dist 目录
右键点击 uninstall.bat，选择"以管理员身份运行"

（如果 .bat 文件不工作，可以右键点击 uninstall.ps1，选择"使用 PowerShell 运行"）

========================================
常见问题
========================================

问：安装失败？
答：确保以管理员权限运行 install.ps1

问：菜单没有显示？
答：重启资源管理器（任务管理器 > Windows 资源管理器 > 重新启动）

问：构建时找不到 MSBuild？
答：安装 Visual Studio 时选择"使用 C++ 的桌面开发"工作负载

========================================
自定义
========================================

修改菜单文字：
编辑 com_handler/ContextMenuHandler.cpp 的 GetTitle 函数

修改点击后的功能：
编辑 src/main.rs 的 "clicked" 分支代码

========================================
技术说明
========================================

本方案使用 Sparse Package + IExplorerCommand 接口
这是 Windows 11 新右键菜单的官方技术方案

文件说明：
- contextmenu.exe：简单的占位程序（提供包标识）
- ContextMenuHandler.dll：C++ COM 组件（实现右键菜单功能）
- ContextMenu.msix：Sparse Package 安装包

安装位置：C:\Program Files\ContextMenu
